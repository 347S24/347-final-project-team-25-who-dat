<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <title>Who Dat?</title>

    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/js/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"></script>

    <style>
        .calendar-grid {
            display: flex;
            flex-wrap: wrap;
            width: 350px;
        }
        /* Initially hide the calendar grid and attendance buttons */
        .calendar-grid, .attendance-buttons, .students-list {
            display: none;
        }
        .day-box {
            width: 50px;
            height: 50px;
            margin: 5px;
            text-align: center;
            line-height: 50px;
            border: 1px solid #ccc;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Professor Calendar - {{ month }} {{ year }}</h1>
    <a href="../../../homepage/">home</a>

    <!-- Course Selection Dropdown -->
    <label for="course-select">Select a Course:</label>
    <select id="course-select">
        <option value="" selected disabled>Select a course</option>
        {% for course in courses %}
            <option value="{{ course.course_id }}">{{ course.course_id }} - {{ course.name }}</option>
        {% endfor %}
    </select>

    <!-- Calendar Grid -->
    <div id="calendar-grid" class="calendar-grid">
        {% for day in days %}
            <div class="day-box" onclick="showAttendanceButtons({{ day }})">
                {{ day }}
            </div>
        {% endfor %}
    </div>

    <!-- Attendance Buttons -->
    <div class="attendance-buttons" id="attendance-buttons">
        <h3>Actions for Day <span id="selected-day"></span></h3>
        <button>Mark Attendance</button>
        <button>Modify Attendance</button>
        <button onclick="viewPresents()">View Presents</button>
        <button onclick="viewAbsents()">View Absents</button>
    </div>

    <!-- Students List -->
    <div id="students-list" class="students-list" style="display:none;">
        <pre>{{ courses.students }}</pre>
        <h3>Students List</h3>
        <ul id="students-list-content">
            {% for student in courses.students %}
                <li>
                    <img src="{{ student.url }}" alt="{{ student.name }}" width="50" height="50">
                    {{ student.name }} - {{ student.status }}
                </li>
            {% endfor %}
        </ul>
        <button onclick="closeStudentsList()">Close</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var courseSelect = document.getElementById('course-select');
            var calendarGrid = document.getElementById('calendar-grid');
            var attendanceButtons = document.getElementById('attendance-buttons');

            // Ensure all expected elements are found
            if (courseSelect && calendarGrid && attendanceButtons) {
                courseSelect.addEventListener('change', function() {
                    var selectedCourse = this.value;

                    if (selectedCourse) {
                        // Make the calendar and attendance buttons visible
                        console.log("Course selected:", selectedCourse);
                        calendarGrid.style.display = 'flex';
                        attendanceButtons.style.display = 'block';
                    }
                });
            } else {
                console.error("One or more required elements were not found.");
            }
        });

        // Function to show attendance buttons for the selected day
        function showAttendanceButtons(day) {
            console.log("Day selected:", day);
            document.getElementById('selected-day').innerText = day;
        }

        // Display the list of students marked as present (initially empty)
        function viewPresents() {
            var studentsList = document.getElementById('student-list')
            var listContent = document.getElementById('student-list-content')

            // Filter to only show students marked as present
            var presentStudents = Array.from(listContent.getElementsByTagName('li')).filter(function (item) {
                return item.innerText.includes('present');
            });

            listContent.innerHTML = presentStudents.length ? presentStudents.map(function (item) {
                return '<li>' + item.innerHTML + '</li>';
            }).join('') : '<li>No students are present</li>';

            // Show the list
            studentsList.style.display = 'block';
        }

        // Function to view students marked as "absent"
        function viewAbsents() {
            var studentsList = document.getElementById('students-list');
            var listContent = document.getElementById('students-list-content');

            // Extract the existing students from the list
            var allStudents = Array.from(listContent.getElementsByTagName('li'));

            // Filter students that are marked as "absent"
            var absentStudents = allStudents.filter(function(item) {
                return item.innerText.includes('absent');
            });

            // Check if any students are absent
            if (absentStudents.length) {
                listContent.innerHTML = absentStudents.map(function(item) {
                    return '<li>' + item.innerHTML + '</li>';
                }).join('');
            } else {
                listContent.innerHTML = '<li>All students are present</li>';
            }

            // Show the modal/list
            studentsList.style.display = 'block';
        }

        function closeStudentsList() {
            document.getElementById('students-list').style.display = 'none';
        }

    </script>
</body>
</html>
